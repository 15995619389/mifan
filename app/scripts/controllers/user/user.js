// Generated by CoffeeScript 1.7.1
"use strict";
Mifan.controller("userCtrl", function($scope, $timeout, $http, $routeParams) {
  var follow, legalFeedTypes, user, userid;
  userid = $routeParams.id;
  if ($scope.UID === userid) {
    return LOC["href"] = "#!/me";
  }
  $scope.$on("$viewContentLoaded", function() {
    return $scope.$emit("pageChange", "user");
  });
  legalFeedTypes = ["ask", "answer", "love"];
  $scope.feedType = "ask";
  $scope.loadingMore = function() {
    return $scope.isLoading = true;
  };
  $scope.switchFeed = function(type) {
    type = type || "ask";
    $scope.feedType = type;
    return $scope.isLoading = false;
  };
  user = {
    init: function() {
      user.getMyAsk();
      $timeout(user.getMyAnswer, 500);
      $scope.myAskMsg = $scope.myAnswerMsg = $scope.myLoveMsg = "";
      $scope.myAsk = $scope.myAnswer = $scope.myLove = [];
      $scope.myAskMore = $scope.myAnswerMore = $scope.myLoveMore = false;
      return $scope.followed = false;
    },
    getMyAsk: function() {
      var api;
      api = "" + API.myask + $scope.privacyParamDir;
      if (IsDebug) {
        api = API.myask;
      }
      return $http.get(api).success(user.getMyAskCb);
    },
    getMyAskCb: function(data) {
      if (String(data.msg) === "ok") {
        return $scope.myAsk = data.result || [];
      } else {
        return $scope.myAskMsg = data.msg;
      }
    },
    getMyAnswer: function() {
      var api;
      api = "" + API.myanswer + $scope.privacyParamDir;
      if (IsDebug) {
        api = API.myanswer;
      }
      return $http.get(api).success(user.getMyAnswerCb);
    },
    getMyAnswerCb: function(data) {
      if (String(data.msg) === "ok") {
        return $scope.myAnswer = data.result || [];
      } else {
        return $scope.myAnswerMsg = data.msg;
      }
    }
  };
  user.init();
  $scope.askHim = function() {
    return $scope.showAskBox = !$scope.showAskBox;
  };
  follow = {
    init: function() {
      $scope.follow = follow.follow;
      $scope.unfollow = follow.unfollow;
      $scope.$on("followCb", function(event, data) {
        return follow.onFollowCb(data);
      });
      return $scope.$on("unfollowCb", function(event, data) {
        return follow.onUnfollowCb(data);
      });
    },
    follow: function() {
      return $scope.$emit("follow", {
        userid: userid
      });
    },
    unfollow: function() {
      return $scope.$emit("unfollow", {
        userid: userid
      });
    },
    onFollowCb: function(data) {
      var msg;
      msg = data.msg;
      $scope.toast(msg);
      if (msg === "ok") {
        return $scope.followed = true;
      }
    },
    onUnfollowCb: function(data) {
      var msg;
      msg = data.msg;
      $scope.toast(msg);
      if (msg === "ok") {
        return $scope.followed = false;
      }
    }
  };
  return follow.init();
});
