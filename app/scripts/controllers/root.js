// Generated by CoffeeScript 1.7.1
"use strict";
Mifan.controller("rootCtrl", function($scope, $cookieStore, $http) {
  var API, DOC, IsDebug, LOC, WIN, accessToken, getUserInfo, getUserInfoCb, getUserInfoErrorCb, setUserInfo, toggleMMenu, uid, username;
  WIN = $scope.WIN;
  DOC = $scope.DOC;
  LOC = $scope.LOC;
  API = $scope.API;
  IsDebug = $scope.IsDebug;
  $scope.page = "home";
  $scope.accessToken = $scope.UID = void 0;
  $scope.isLogin = false;
  $scope.$on("onLogined", function(detail, result) {
    var user;
    $scope.isLogin = true;
    $scope.accessToken = result["accesstoken"];
    user = result["user"];
    $scope.UID = user["userid"];
    setUserInfo(user);
    $scope.user.accessToken = accessToken;
    $cookieStore.put("mUID", user["userid"]);
    $cookieStore.put("mUsername", user["username"]);
    return $cookieStore.put("mAccessToken", $scope.accessToken);
  });
  setUserInfo = function(user) {
    $scope.user.username = user["username"] || "";
    $scope.user.email = user["email"] || "";
    $scope.user.face = user["face"] || "";
    $scope.user.face_60 = user["face_60"] || "";
    $scope.user.face_120 = user["face_120"] || "";
    $scope.user.sex = user["sex"] || "1";
    $scope.user.blog = user["blog"] || "";
    return $scope.user.uid = user["userid"] || "";
  };
  getUserInfo = function() {
    var url;
    url = ("" + API.userInfo) + (IsDebug ? "" : "/" + uid) + ("" + $scope.privacyParam);
    return $http.get(url).success(getUserInfoCb).error(getUserInfoErrorCb);
  };
  getUserInfoCb = function(data) {
    var ret, user;
    ret = data["ret"];
    if (ret === "100000") {
      user = data["result"];
      return setUserInfo(user);
    }
  };
  getUserInfoErrorCb = function(data) {};
  $scope.user = {};
  uid = $cookieStore.get("mUID");
  accessToken = $cookieStore.get("mAccessToken");
  username = $cookieStore.get("mUsername");
  if (uid && accessToken) {
    $scope.isLogin = true;
    $scope.user.uid = $scope.UID = uid;
    $scope.accessToken = accessToken;
    $scope.user.face_60 = $scope.user.face_120 = $scope.DEFAULT_FACE;
    $scope.user.username = username;
    $scope.privacyParam = "?access_token=" + accessToken + "&userid=" + uid;
    getUserInfo();
  }
  $scope.supportNum = "1ä¸‡";
  $scope.$on("pageChange", function(e, msg) {
    return $scope.page = msg;
  });
  $scope.isMMenuOpen = false;
  $scope.toggleMMenu = toggleMMenu = function() {
    return $scope.isMMenuOpen = !$scope.isMMenuOpen;
  };
  $scope.logout = function() {
    $scope.user = {};
    $cookieStore.remove("mUID");
    $cookieStore.remove("mAccessToken");
    return $scope.isLogin = false;
  };
  $scope.href = function(url, isToggleMmenu) {
    LOC["href"] = url;
    if (isToggleMmenu) {
      return toggleMMenu();
    }
  };
  return $scope.scroll1Px = function() {
    var el;
    el = DOC["getElementById"]("m-wrap");
    if (el.scrollTop === 0) {
      return el.scrollTop = 1;
    }
  };
});
